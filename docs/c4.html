<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>WMS — Full C4 Architecture</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;700&family=Outfit:wght@300;400;500;600;700;800&display=swap');

  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  :root {
    --bg: #f4f6f9;
    --white: #ffffff;
    --border: #e2e6ed;
    --text: #1a1d23;
    --muted: #6b7280;
    --mono: 'JetBrains Mono', monospace;
    --sans: 'Outfit', sans-serif;

    --person-bg: #e8f4f8;
    --person-border: #1a6b8a;
    --person-text: #1a6b8a;

    --system-bg: #e8f5ee;
    --system-border: #1a5c2e;
    --system-text: #1a5c2e;

    --external-bg: #fdf5e0;
    --external-border: #8a6a1a;
    --external-text: #8a6a1a;

    --container-bg: #f0ecfc;
    --container-border: #4a2d8a;
    --container-text: #4a2d8a;

    --component-bg: #fceaea;
    --component-border: #8a1a1a;
    --component-text: #8a1a1a;

    --db-bg: #e8f0f8;
    --db-border: #1a4a8a;
    --db-text: #1a4a8a;

    --kafka-bg: #fff3e8;
    --kafka-border: #c26a1a;
    --kafka-text: #c26a1a;

    --batch-bg: #fefbe8;
    --batch-border: #8a7a1a;
    --batch-text: #8a7a1a;
  }

  body {
    background: var(--bg);
    font-family: var(--sans);
    color: var(--text);
    padding: 0;
  }

  /* HEADER */
  .site-header {
    background: var(--text);
    color: white;
    padding: 40px 48px;
  }

  .site-header .tag {
    font-family: var(--mono);
    font-size: 11px;
    color: #6b7280;
    letter-spacing: 3px;
    margin-bottom: 12px;
    display: block;
  }

  .site-header h1 {
    font-size: 40px;
    font-weight: 800;
    letter-spacing: -1px;
    margin-bottom: 8px;
  }

  .site-header h1 span { color: #00e5a0; }

  .site-header p {
    color: #9ca3af;
    font-size: 15px;
    max-width: 600px;
    line-height: 1.6;
  }

  /* NAV */
  .nav-bar {
    background: var(--white);
    border-bottom: 1px solid var(--border);
    padding: 0 48px;
    display: flex;
    gap: 0;
    position: sticky;
    top: 0;
    z-index: 100;
  }

  .nav-tab {
    padding: 18px 24px;
    border: none;
    background: transparent;
    font-family: var(--sans);
    font-size: 13px;
    font-weight: 600;
    color: var(--muted);
    cursor: pointer;
    border-bottom: 3px solid transparent;
    transition: all 0.15s;
  }

  .nav-tab.active {
    color: var(--text);
    border-bottom-color: var(--text);
  }

  .nav-tab:hover { color: var(--text); }

  /* PAGES */
  .page { display: none; padding: 48px; }
  .page.active { display: block; }

  /* PAGE HEADER */
  .page-header {
    display: flex;
    gap: 24px;
    margin-bottom: 48px;
    align-items: flex-start;
  }

  .level-badge {
    background: var(--text);
    color: white;
    font-family: var(--mono);
    font-size: 12px;
    font-weight: 700;
    padding: 8px 16px;
    border-radius: 6px;
    white-space: nowrap;
    flex-shrink: 0;
  }

  .page-header-text h2 {
    font-size: 28px;
    font-weight: 800;
    letter-spacing: -0.5px;
    margin-bottom: 8px;
  }

  .page-header-text p {
    color: var(--muted);
    font-size: 14px;
    line-height: 1.7;
    max-width: 700px;
  }

  /* SECTION */
  .section {
    margin-bottom: 48px;
  }

  .section-title {
    font-family: var(--mono);
    font-size: 10px;
    letter-spacing: 3px;
    text-transform: uppercase;
    color: var(--muted);
    margin-bottom: 20px;
    display: flex;
    align-items: center;
    gap: 12px;
  }

  .section-title::after {
    content: '';
    flex: 1;
    height: 1px;
    background: var(--border);
  }

  /* EXPLANATION BOX */
  .explanation {
    background: var(--white);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 24px;
    margin-bottom: 32px;
    font-size: 14px;
    line-height: 1.8;
    color: var(--muted);
  }

  .explanation strong { color: var(--text); }

  /* NODE CARDS */
  .node-card {
    border-radius: 10px;
    padding: 20px;
    border: 2px solid;
    text-align: center;
  }

  .node-card .n-icon { font-size: 28px; margin-bottom: 10px; display: block; }
  .node-card .n-type {
    font-family: var(--mono);
    font-size: 9px;
    font-weight: 700;
    letter-spacing: 2px;
    text-transform: uppercase;
    margin-bottom: 6px;
    display: block;
  }
  .node-card .n-name {
    font-size: 14px;
    font-weight: 700;
    margin-bottom: 6px;
    display: block;
    line-height: 1.3;
  }
  .node-card .n-desc {
    font-size: 11px;
    line-height: 1.5;
    opacity: 0.8;
  }
  .node-card .n-tech {
    margin-top: 10px;
    font-family: var(--mono);
    font-size: 9px;
    background: rgba(255,255,255,0.6);
    padding: 3px 8px;
    border-radius: 4px;
    display: inline-block;
  }

  .person-card { background: var(--person-bg); border-color: var(--person-border); }
  .person-card .n-type, .person-card .n-name { color: var(--person-text); }

  .system-card { background: var(--system-bg); border-color: var(--system-border); }
  .system-card .n-type, .system-card .n-name { color: var(--system-text); }

  .external-card { background: var(--external-bg); border-color: var(--external-border); }
  .external-card .n-type, .external-card .n-name { color: var(--external-text); }

  .container-card { background: var(--container-bg); border-color: var(--container-border); }
  .container-card .n-type, .container-card .n-name { color: var(--container-text); }

  .component-card { background: var(--component-bg); border-color: var(--component-border); }
  .component-card .n-type, .component-card .n-name { color: var(--component-text); }

  .db-card { background: var(--db-bg); border-color: var(--db-border); }
  .db-card .n-type, .db-card .n-name { color: var(--db-text); }

  .kafka-card { background: var(--kafka-bg); border-color: var(--kafka-border); }
  .kafka-card .n-type, .kafka-card .n-name { color: var(--kafka-text); }

  .batch-card { background: var(--batch-bg); border-color: var(--batch-border); }
  .batch-card .n-type, .batch-card .n-name { color: var(--batch-text); }

  /* RELATIONSHIP TABLE */
  .rel-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 13px;
  }

  .rel-table th {
    background: var(--text);
    color: white;
    padding: 10px 16px;
    text-align: left;
    font-family: var(--mono);
    font-size: 10px;
    letter-spacing: 1px;
    font-weight: 500;
  }

  .rel-table td {
    padding: 10px 16px;
    border-bottom: 1px solid var(--border);
    vertical-align: top;
  }

  .rel-table tr:last-child td { border-bottom: none; }
  .rel-table tr:nth-child(even) td { background: #f9fafb; }

  .rel-table .from { font-weight: 600; }
  .rel-table .arrow { color: var(--muted); text-align: center; }
  .rel-table .to { font-weight: 600; }
  .rel-table .desc { color: var(--muted); font-size: 12px; }
  .rel-table .tech { font-family: var(--mono); font-size: 10px; color: var(--muted); }

  /* DIAGRAM LAYOUTS */
  .context-diagram {
    background: var(--white);
    border: 1px solid var(--border);
    border-radius: 16px;
    padding: 40px;
  }

  .context-grid {
    display: grid;
    grid-template-columns: 220px 1fr 220px;
    gap: 24px;
    align-items: center;
    min-height: 420px;
  }

  .actors-col { display: flex; flex-direction: column; gap: 16px; }

  .center-system {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 12px;
  }

  .center-node {
    border-radius: 16px;
    padding: 32px;
    border: 3px solid;
    text-align: center;
    width: 100%;
  }

  .arrow-label {
    font-family: var(--mono);
    font-size: 10px;
    color: var(--muted);
    background: var(--bg);
    padding: 4px 12px;
    border-radius: 4px;
    border: 1px solid var(--border);
  }

  /* CONTAINER DIAGRAM */
  .container-diagram {
    background: var(--white);
    border: 1px solid var(--border);
    border-radius: 16px;
    padding: 40px;
  }

  .container-grid {
    display: grid;
    grid-template-columns: 180px 1fr 180px;
    gap: 32px;
    align-items: start;
  }

  .boundary-box {
    border: 2px dashed #cbd5e1;
    border-radius: 12px;
    padding: 24px;
    position: relative;
  }

  .boundary-label {
    position: absolute;
    top: -11px;
    left: 16px;
    background: var(--white);
    padding: 0 8px;
    font-family: var(--mono);
    font-size: 10px;
    color: var(--muted);
    letter-spacing: 1px;
  }

  .boundary-inner {
    display: flex;
    flex-direction: column;
    gap: 16px;
  }

  .connector {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    padding: 6px 0;
  }

  .connector-line {
    flex: 1;
    height: 1px;
    background: #cbd5e1;
    position: relative;
  }

  .connector-line.right::after {
    content: '\25B6';
    position: absolute;
    right: -6px;
    top: -7px;
    font-size: 10px;
    color: #9ca3af;
  }

  .connector-line.left::before {
    content: '\25C0';
    position: absolute;
    left: -6px;
    top: -7px;
    font-size: 10px;
    color: #9ca3af;
  }

  .connector-line.both::after {
    content: '\25B6';
    position: absolute;
    right: -6px;
    top: -7px;
    font-size: 10px;
    color: #9ca3af;
  }

  .connector-line.both::before {
    content: '\25C0';
    position: absolute;
    left: -6px;
    top: -7px;
    font-size: 10px;
    color: #9ca3af;
  }

  .connector-text {
    font-family: var(--mono);
    font-size: 9px;
    color: var(--muted);
    white-space: nowrap;
    background: var(--bg);
    padding: 2px 6px;
    border-radius: 3px;
  }

  /* COMPONENT DIAGRAM */
  .component-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 16px;
  }

  .component-item {
    background: var(--component-bg);
    border: 2px solid var(--component-border);
    border-radius: 10px;
    padding: 18px;
  }

  .component-item .ci-icon { font-size: 22px; margin-bottom: 8px; display: block; }
  .component-item .ci-type {
    font-family: var(--mono);
    font-size: 9px;
    color: var(--component-text);
    letter-spacing: 1px;
    margin-bottom: 4px;
    display: block;
  }
  .component-item .ci-name {
    font-size: 13px;
    font-weight: 700;
    color: var(--component-text);
    margin-bottom: 8px;
    display: block;
  }
  .component-item .ci-desc {
    font-size: 11px;
    color: var(--muted);
    line-height: 1.5;
    margin-bottom: 8px;
  }
  .component-item .ci-endpoints {
    font-family: var(--mono);
    font-size: 9px;
    color: var(--muted);
    line-height: 1.8;
  }
  .component-item .ci-tech {
    margin-top: 8px;
    font-family: var(--mono);
    font-size: 9px;
    background: white;
    padding: 2px 6px;
    border-radius: 3px;
    display: inline-block;
    color: var(--muted);
  }

  /* KAFKA EVENT TABLE */
  .kafka-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 12px;
  }

  .kafka-event {
    background: var(--kafka-bg);
    border: 1px solid var(--kafka-border);
    border-radius: 8px;
    padding: 14px 16px;
    display: flex;
    gap: 12px;
    align-items: flex-start;
  }

  .kafka-event .ke-topic {
    font-family: var(--mono);
    font-size: 11px;
    font-weight: 700;
    color: var(--kafka-text);
    min-width: 180px;
  }

  .kafka-event .ke-flow {
    font-size: 11px;
    color: var(--muted);
    line-height: 1.5;
  }

  /* ENTITY DIAGRAM */
  .entity-modules {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 20px;
  }

  .entity-module {
    background: var(--white);
    border: 1px solid var(--border);
    border-radius: 12px;
    overflow: hidden;
  }

  .em-header {
    padding: 14px 18px;
    font-size: 13px;
    font-weight: 700;
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .em-body { padding: 16px 18px; }

  .em-entity {
    margin-bottom: 14px;
    padding-bottom: 14px;
    border-bottom: 1px solid var(--border);
  }

  .em-entity:last-child { margin-bottom: 0; padding-bottom: 0; border-bottom: none; }

  .em-entity-name {
    font-family: var(--mono);
    font-size: 11px;
    font-weight: 700;
    margin-bottom: 6px;
    display: block;
  }

  .em-fields {
    display: flex;
    flex-direction: column;
    gap: 2px;
  }

  .em-field {
    display: flex;
    justify-content: space-between;
    font-size: 10px;
    padding: 2px 0;
  }

  .em-field-name { font-family: var(--mono); color: var(--text); }
  .em-field-type { font-family: var(--mono); color: var(--muted); }
  .pk { color: #f59e0b; font-weight: 700; }
  .fk { color: #3b82f6; }

  /* LEGEND */
  .legend {
    display: flex;
    flex-wrap: wrap;
    gap: 16px;
    margin-top: 24px;
    padding: 16px;
    background: var(--white);
    border: 1px solid var(--border);
    border-radius: 8px;
  }

  .legend-item {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 12px;
    color: var(--muted);
  }

  .legend-box {
    width: 16px;
    height: 16px;
    border-radius: 3px;
    border: 2px solid;
    flex-shrink: 0;
  }

  /* WHAT/WHY boxes */
  .info-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 16px;
    margin-bottom: 32px;
  }

  .info-box {
    background: var(--white);
    border: 1px solid var(--border);
    border-radius: 10px;
    padding: 20px;
  }

  .info-box h4 {
    font-family: var(--mono);
    font-size: 10px;
    letter-spacing: 2px;
    color: var(--muted);
    margin-bottom: 10px;
  }

  .info-box p {
    font-size: 13px;
    line-height: 1.7;
    color: var(--text);
  }

  /* VERTICAL ARROW */
  .v-arrow {
    text-align: center;
    color: #9ca3af;
    font-size: 20px;
    padding: 4px 0;
  }

  /* SERVICE GRID for L2 */
  .services-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 12px;
  }

  .service-card {
    border-radius: 10px;
    padding: 16px;
    border: 2px solid;
    text-align: center;
  }

  .service-card .s-icon { font-size: 24px; margin-bottom: 8px; display: block; }
  .service-card .s-type {
    font-family: var(--mono);
    font-size: 8px;
    font-weight: 700;
    letter-spacing: 2px;
    text-transform: uppercase;
    margin-bottom: 4px;
    display: block;
  }
  .service-card .s-name {
    font-size: 12px;
    font-weight: 700;
    margin-bottom: 4px;
    display: block;
  }
  .service-card .s-desc {
    font-size: 10px;
    line-height: 1.4;
    opacity: 0.8;
  }
  .service-card .s-tech {
    margin-top: 8px;
    font-family: var(--mono);
    font-size: 8px;
    background: rgba(255,255,255,0.6);
    padding: 2px 6px;
    border-radius: 4px;
    display: inline-block;
  }

  .infra-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 12px;
    margin-top: 16px;
  }
</style>
</head>
<body>

<nav style="background:#1a1d23;padding:0 48px;display:flex;gap:0;border-bottom:2px solid #00e5a0;">
  <a href="index.html" style="padding:14px 20px;text-decoration:none;font-family:'Outfit',sans-serif;font-size:13px;font-weight:600;color:#9ca3af;">Overview</a>
  <a href="c4.html" style="padding:14px 20px;text-decoration:none;font-family:'Outfit',sans-serif;font-size:13px;font-weight:600;color:#00e5a0;border-bottom:3px solid #00e5a0;">C4 Architecture</a>
  <a href="database.html" style="padding:14px 20px;text-decoration:none;font-family:'Outfit',sans-serif;font-size:13px;font-weight:600;color:#9ca3af;">Database</a>
  <a href="api.html" style="padding:14px 20px;text-decoration:none;font-family:'Outfit',sans-serif;font-size:13px;font-weight:600;color:#9ca3af;">API</a>
  <a href="kafka.html" style="padding:14px 20px;text-decoration:none;font-family:'Outfit',sans-serif;font-size:13px;font-weight:600;color:#9ca3af;">Kafka Events</a>
</nav>

<!-- SITE HEADER -->
<div class="site-header">
  <span class="tag">C4 MODEL — ARCHITECTURE DOCUMENTATION</span>
  <h1>Warehouse<span>Management</span>System</h1>
  <p>Complete C4 architecture documentation covering all four levels — from high-level system context down to individual entities and their relationships.</p>
</div>

<!-- NAV -->
<div class="nav-bar">
  <button class="nav-tab active" onclick="showPage('l1', this)">L1 — Context</button>
  <button class="nav-tab" onclick="showPage('l2', this)">L2 — Container</button>
  <button class="nav-tab" onclick="showPage('l3', this)">L3 — Component</button>
  <button class="nav-tab" onclick="showPage('l4', this)">L4 — Code</button>
</div>

<!-- =========================================== LEVEL 1 =========================================== -->
<div class="page active" id="l1">

  <div class="page-header">
    <div class="level-badge">LEVEL 1</div>
    <div class="page-header-text">
      <h2>System Context Diagram</h2>
      <p>The highest level of abstraction. Shows <strong>WarehouseManagementSystem</strong> as a black box in the center, surrounded by the people who use it and the external systems it depends on. At this level we don't care about technology — only about <em>who</em> uses the system and <em>what</em> it connects to.</p>
    </div>
  </div>

  <div class="info-grid">
    <div class="info-box">
      <h4>WHAT THIS DIAGRAM SHOWS</h4>
      <p>The system and everything outside it. Users (people), our software system, and external systems it integrates with. No internal details.</p>
    </div>
    <div class="info-box">
      <h4>WHO THIS DIAGRAM IS FOR</h4>
      <p>Non-technical stakeholders, project managers, business owners. Anyone who needs to understand what the system does and who interacts with it — without any technical knowledge required.</p>
    </div>
  </div>

  <!-- DIAGRAM -->
  <div class="section">
    <div class="section-title">Diagram</div>
    <div class="context-diagram">
      <div class="context-grid">

        <!-- LEFT — Actors -->
        <div class="actors-col">
          <div class="node-card person-card">
            <span class="n-icon">&#x1F464;</span>
            <span class="n-type">Person</span>
            <span class="n-name">Warehouse Owner</span>
            <span class="n-desc">Registers warehouses, configures zones and rooms, manages staff and delivery agents, approves bookings and goods</span>
          </div>
          <div class="node-card person-card">
            <span class="n-icon">&#x1F3EA;</span>
            <span class="n-type">Person</span>
            <span class="n-name">Customer</span>
            <span class="n-desc">Browses warehouses, books storage, uploads goods, requests and tracks deliveries, pays invoices</span>
          </div>
          <div class="node-card person-card">
            <span class="n-icon">&#x1F477;</span>
            <span class="n-type">Person</span>
            <span class="n-name">Staff</span>
            <span class="n-desc">Receives goods, picks and packs orders, notifies delivery agents when goods are ready</span>
          </div>
          <div class="node-card person-card">
            <span class="n-icon">&#x1F69B;</span>
            <span class="n-type">Person</span>
            <span class="n-name">Delivery Agent</span>
            <span class="n-desc">Claims deliveries, picks up goods from warehouse, updates shipment checkpoints, delivers to customer</span>
          </div>
          <div class="node-card person-card">
            <span class="n-icon">&#x1F510;</span>
            <span class="n-type">Person</span>
            <span class="n-name">Super Admin</span>
            <span class="n-desc">Reviews and approves warehouse owner registrations, manages platform-level access</span>
          </div>
        </div>

        <!-- CENTER -->
        <div class="center-system">
          <div class="arrow-label">&larr; Uses via REST API / HTTPS</div>
          <div class="center-node system-card" style="border-width:3px;">
            <span class="n-icon" style="font-size:48px;">&#x1F3ED;</span>
            <span class="n-type" style="font-size:11px; letter-spacing:2px;">Software System</span>
            <span class="n-name" style="font-size:20px;">WarehouseManagement<br>System</span>
            <span class="n-desc" style="font-size:13px; margin-top:12px; display:block;">An Airbnb-style B2B SaaS platform. Warehouse owners list their storage facilities. Business customers browse, book space, store goods, and request deliveries.</span>
          </div>
          <div class="arrow-label">Integrates with external systems &rarr;</div>
        </div>

        <!-- RIGHT — External -->
        <div class="actors-col">
          <div class="node-card external-card">
            <span class="n-icon">&#x1F4B3;</span>
            <span class="n-type">External System</span>
            <span class="n-name">Stripe</span>
            <span class="n-desc">Payment processing for booking and delivery invoices. Webhooks confirm payment status back to the system.</span>
          </div>
          <div class="node-card external-card">
            <span class="n-icon">&#x1F4E7;</span>
            <span class="n-type">External System</span>
            <span class="n-name">SMTP / SendGrid</span>
            <span class="n-desc">Transactional email delivery. Sends booking confirmations, delivery updates, invoice notifications, and payment receipts.</span>
          </div>
          <div class="node-card external-card">
            <span class="n-icon">&#x1F4CA;</span>
            <span class="n-type">External Format</span>
            <span class="n-name">Excel / CSV</span>
            <span class="n-desc">Used by warehouse owners to define warehouse blueprints (zones, rooms, pricing) and by customers to upload goods lists.</span>
          </div>
        </div>

      </div>
    </div>
  </div>

  <!-- LEGEND -->
  <div class="legend">
    <div class="legend-item"><div class="legend-box" style="background:var(--person-bg); border-color:var(--person-border);"></div> Person — A human user of the system</div>
    <div class="legend-item"><div class="legend-box" style="background:var(--system-bg); border-color:var(--system-border);"></div> Our Software System</div>
    <div class="legend-item"><div class="legend-box" style="background:var(--external-bg); border-color:var(--external-border);"></div> External System — Outside our boundary</div>
  </div>

  <!-- RELATIONSHIPS -->
  <div class="section" style="margin-top:32px;">
    <div class="section-title">All Relationships</div>
    <div style="background:var(--white); border:1px solid var(--border); border-radius:12px; overflow:hidden;">
      <table class="rel-table">
        <thead>
          <tr>
            <th>From</th>
            <th style="text-align:center;">&rarr;</th>
            <th>To</th>
            <th>Description</th>
            <th>Protocol</th>
          </tr>
        </thead>
        <tbody>
          <tr><td class="from">Warehouse Owner</td><td class="arrow">&rarr;</td><td class="to">WMS</td><td class="desc">Registers, configures warehouses, manages zones/rooms, approves bookings and goods imports</td><td class="tech">REST / HTTPS / JSON</td></tr>
          <tr><td class="from">Customer</td><td class="arrow">&rarr;</td><td class="to">WMS</td><td class="desc">Browses warehouses, creates bookings, uploads goods, requests deliveries, pays invoices</td><td class="tech">REST / HTTPS / JSON</td></tr>
          <tr><td class="from">Staff</td><td class="arrow">&rarr;</td><td class="to">WMS</td><td class="desc">Receives goods, confirms quantities, creates pick lists, notifies delivery agents</td><td class="tech">REST / HTTPS / JSON</td></tr>
          <tr><td class="from">Delivery Agent</td><td class="arrow">&rarr;</td><td class="to">WMS</td><td class="desc">Claims deliveries, updates shipment checkpoints, marks deliveries as complete</td><td class="tech">REST / HTTPS / JSON</td></tr>
          <tr><td class="from">Super Admin</td><td class="arrow">&rarr;</td><td class="to">WMS</td><td class="desc">Reviews owner registrations, approves or rejects, manages platform users</td><td class="tech">REST / HTTPS / JSON</td></tr>
          <tr><td class="from">WMS</td><td class="arrow">&rarr;</td><td class="to">Stripe</td><td class="desc">Creates payment checkout sessions, receives webhook callbacks for payment confirmation/failure</td><td class="tech">HTTPS / Stripe SDK</td></tr>
          <tr><td class="from">WMS</td><td class="arrow">&rarr;</td><td class="to">SMTP / SendGrid</td><td class="desc">Sends transactional emails triggered by system events (bookings, payments, deliveries)</td><td class="tech">SMTP / SendGrid API</td></tr>
          <tr><td class="from">Warehouse Owner</td><td class="arrow">&rarr;</td><td class="to">WMS</td><td class="desc">Uploads warehouse blueprint Excel (zones, rooms, pricing, categories)</td><td class="tech">Multipart file upload</td></tr>
          <tr><td class="from">Customer</td><td class="arrow">&rarr;</td><td class="to">WMS</td><td class="desc">Uploads goods list Excel after booking is active</td><td class="tech">Multipart file upload</td></tr>
          <tr><td class="from">WMS</td><td class="arrow">&rarr;</td><td class="to">Excel / CSV</td><td class="desc">Dynamically generates Excel templates for both warehouse blueprints and goods lists</td><td class="tech">Apache POI</td></tr>
        </tbody>
      </table>
    </div>
  </div>

</div>

<!-- =========================================== LEVEL 2 =========================================== -->
<div class="page" id="l2">

  <div class="page-header">
    <div class="level-badge">LEVEL 2</div>
    <div class="page-header-text">
      <h2>Container Diagram</h2>
      <p>Zooms inside <strong>WarehouseManagementSystem</strong> to show its containers — the deployable units and data stores that make up the system. Each microservice is an independently deployable Spring Boot application with its own PostgreSQL database. Services communicate asynchronously via Kafka events and synchronously via REST (HTTP) for request-response queries.</p>
    </div>
  </div>

  <div class="info-grid">
    <div class="info-box">
      <h4>WHAT THIS DIAGRAM SHOWS</h4>
      <p>The deployable pieces inside the system boundary: 7 Spring Boot microservices (each with its own PostgreSQL database), Spring Cloud infrastructure (Eureka, Config Server, API Gateway), Apache Kafka with Transactional Outbox pattern, Redis cache, and Zipkin for distributed tracing.</p>
    </div>
    <div class="info-box">
      <h4>KEY ARCHITECTURAL DECISION</h4>
      <p><strong>Microservices with Database-Per-Service.</strong> Each service owns its data exclusively — no shared databases. Inter-service communication uses Kafka (via Transactional Outbox pattern) for async events and REST/HTTP with Resilience4j circuit breakers for synchronous queries. Spring Cloud Eureka for service discovery, Config Server for centralized configuration, Micrometer + Zipkin for distributed tracing.</p>
    </div>
  </div>

  <!-- DIAGRAM -->
  <div class="section">
    <div class="section-title">Diagram</div>
    <div class="container-diagram">
      <div class="container-grid">

        <!-- LEFT — Users -->
        <div>
          <div style="font-family:var(--mono); font-size:9px; color:var(--muted); letter-spacing:2px; margin-bottom:12px; text-align:center;">USERS</div>
          <div style="display:flex; flex-direction:column; gap:12px;">
            <div class="node-card person-card" style="padding:14px;">
              <span class="n-icon" style="font-size:20px;">&#x1F464;</span>
              <span class="n-type" style="font-size:8px;">Person</span>
              <span class="n-name" style="font-size:12px;">Warehouse Owner</span>
            </div>
            <div class="node-card person-card" style="padding:14px;">
              <span class="n-icon" style="font-size:20px;">&#x1F3EA;</span>
              <span class="n-type" style="font-size:8px;">Person</span>
              <span class="n-name" style="font-size:12px;">Customer</span>
            </div>
            <div class="node-card person-card" style="padding:14px;">
              <span class="n-icon" style="font-size:20px;">&#x1F477;</span>
              <span class="n-type" style="font-size:8px;">Person</span>
              <span class="n-name" style="font-size:12px;">Staff</span>
            </div>
            <div class="node-card person-card" style="padding:14px;">
              <span class="n-icon" style="font-size:20px;">&#x1F69B;</span>
              <span class="n-type" style="font-size:8px;">Person</span>
              <span class="n-name" style="font-size:12px;">Delivery Agent</span>
            </div>
            <div class="node-card person-card" style="padding:14px;">
              <span class="n-icon" style="font-size:20px;">&#x1F510;</span>
              <span class="n-type" style="font-size:8px;">Person</span>
              <span class="n-name" style="font-size:12px;">Super Admin</span>
            </div>
          </div>
        </div>

        <!-- CENTER — System Boundary -->
        <div>
          <div style="font-family:var(--mono); font-size:9px; color:var(--muted); letter-spacing:2px; margin-bottom:12px; text-align:center;">WAREHOUSEMANAGEMENTSYSTEM [BOUNDARY]</div>
          <div class="boundary-box">
            <span class="boundary-label">SYSTEM BOUNDARY</span>
            <div class="boundary-inner">

              <!-- API Gateway -->
              <div class="node-card system-card" style="border-width:3px;">
                <span class="n-icon">&#x1F6E1;&#xFE0F;</span>
                <span class="n-type">Container — API Gateway</span>
                <span class="n-name">API Gateway</span>
                <span class="n-desc">Single entry point for all client requests. Routes to appropriate microservice. Handles JWT validation, rate limiting, and request routing.</span>
                <span class="n-tech">Spring Cloud Gateway &middot; Port 8080</span>
              </div>

              <div class="v-arrow">&darr;</div>

              <!-- Microservices Row -->
              <div style="display:grid; grid-template-columns:repeat(4, 1fr); gap:10px;">

                <div class="service-card system-card">
                  <span class="s-icon">&#x1F510;</span>
                  <span class="s-type">Microservice</span>
                  <span class="s-name">Identity Service</span>
                  <span class="s-desc">Auth, users, all profiles, JWT, Super Admin ops</span>
                  <span class="s-tech">Port 8081</span>
                </div>

                <div class="service-card system-card">
                  <span class="s-icon">&#x1F3ED;</span>
                  <span class="s-type">Microservice</span>
                  <span class="s-name">Warehouse Service</span>
                  <span class="s-desc">Warehouses, zones, rooms, categories, Excel import</span>
                  <span class="s-tech">Port 8082</span>
                </div>

                <div class="service-card system-card">
                  <span class="s-icon">&#x1F4C5;</span>
                  <span class="s-type">Microservice</span>
                  <span class="s-name">Booking Service</span>
                  <span class="s-desc">Booking lifecycle, availability checks, expiry tracking</span>
                  <span class="s-tech">Port 8083</span>
                </div>

                <div class="service-card system-card">
                  <span class="s-icon">&#x1F4E6;</span>
                  <span class="s-type">Microservice</span>
                  <span class="s-name">Goods Service</span>
                  <span class="s-desc">Goods import, items, receipts, discrepancy handling</span>
                  <span class="s-tech">Port 8084</span>
                </div>

              </div>

              <div style="display:grid; grid-template-columns:repeat(3, 1fr); gap:10px;">

                <div class="service-card system-card">
                  <span class="s-icon">&#x1F69A;</span>
                  <span class="s-type">Microservice</span>
                  <span class="s-name">Delivery Service</span>
                  <span class="s-desc">Delivery requests, picking, shipments, checkpoints</span>
                  <span class="s-tech">Port 8085</span>
                </div>

                <div class="service-card system-card">
                  <span class="s-icon">&#x1F4B3;</span>
                  <span class="s-type">Microservice</span>
                  <span class="s-name">Billing Service</span>
                  <span class="s-desc">Invoices, Stripe payments, credit notes</span>
                  <span class="s-tech">Port 8086</span>
                </div>

                <div class="service-card system-card">
                  <span class="s-icon">&#x1F514;</span>
                  <span class="s-type">Microservice</span>
                  <span class="s-name">Platform Service</span>
                  <span class="s-desc">Notifications, audit logs, scheduled batch jobs</span>
                  <span class="s-tech">Port 8087</span>
                </div>

              </div>

              <div class="v-arrow">&darr;</div>

              <!-- Infrastructure Row 1 — Spring Cloud -->
              <div class="infra-grid">

                <div class="node-card container-card">
                  <span class="n-icon">&#x1F50D;</span>
                  <span class="n-type">Container — Service Discovery</span>
                  <span class="n-name">Eureka Server</span>
                  <span class="n-desc">Service registry. All microservices register on startup. API Gateway and Feign clients discover services by name.</span>
                  <span class="n-tech">Spring Cloud Netflix Eureka &middot; Port 8761</span>
                </div>

                <div class="node-card container-card">
                  <span class="n-icon">&#x2699;&#xFE0F;</span>
                  <span class="n-type">Container — Config</span>
                  <span class="n-name">Config Server</span>
                  <span class="n-desc">Centralized configuration for all services. Stores application.yml per environment. Services fetch config on startup.</span>
                  <span class="n-tech">Spring Cloud Config &middot; Port 8888</span>
                </div>

                <div class="node-card container-card">
                  <span class="n-icon">&#x1F52C;</span>
                  <span class="n-type">Container — Tracing</span>
                  <span class="n-name">Zipkin</span>
                  <span class="n-desc">Distributed tracing. Every request gets a trace ID that flows across all services and Kafka events. Visualizes latency and call chains.</span>
                  <span class="n-tech">Zipkin &middot; Micrometer Tracing &middot; Port 9411</span>
                </div>

              </div>

              <div class="v-arrow">&darr;</div>

              <!-- Infrastructure Row 2 — Data -->
              <div class="infra-grid">

                <div class="node-card db-card">
                  <span class="n-icon">&#x1F418;</span>
                  <span class="n-type">Container — Databases</span>
                  <span class="n-name">PostgreSQL (per service)</span>
                  <span class="n-desc">Each microservice has its own PostgreSQL database. No shared database access. Each DB includes an outbox_events table for the Transactional Outbox pattern.</span>
                  <span class="n-tech">PostgreSQL 18 &middot; 7 databases</span>
                </div>

                <div class="node-card kafka-card">
                  <span class="n-icon">&#x1F4E8;</span>
                  <span class="n-type">Container — Message Broker</span>
                  <span class="n-name">Apache Kafka</span>
                  <span class="n-desc">Async event bus. Events are never published directly — they flow through the Transactional Outbox pattern. Dead Letter Topics (DLT) capture failed messages. All consumers are idempotent.</span>
                  <span class="n-tech">Kafka 4 &middot; Port 9092</span>
                </div>

                <div class="node-card container-card">
                  <span class="n-icon">&#x26A1;</span>
                  <span class="n-type">Container — Cache</span>
                  <span class="n-name">Redis</span>
                  <span class="n-desc">Used by Booking Service for room availability locks to prevent double-booking on concurrent requests.</span>
                  <span class="n-tech">Redis 8 &middot; Port 6379</span>
                </div>

              </div>
            </div>
          </div>
        </div>

        <!-- RIGHT — External -->
        <div>
          <div style="font-family:var(--mono); font-size:9px; color:var(--muted); letter-spacing:2px; margin-bottom:12px; text-align:center;">EXTERNAL SYSTEMS</div>
          <div style="display:flex; flex-direction:column; gap:12px;">
            <div class="node-card external-card">
              <span class="n-icon">&#x1F4B3;</span>
              <span class="n-type" style="font-size:8px;">External System</span>
              <span class="n-name" style="font-size:12px;">Stripe</span>
              <span class="n-desc" style="font-size:10px;">Payment checkout sessions and webhook callbacks</span>
              <span class="n-tech">Stripe SDK &middot; HTTPS</span>
            </div>
            <div class="node-card external-card">
              <span class="n-icon">&#x1F4E7;</span>
              <span class="n-type" style="font-size:8px;">External System</span>
              <span class="n-name" style="font-size:12px;">SMTP / SendGrid</span>
              <span class="n-desc" style="font-size:10px;">Transactional email delivery</span>
              <span class="n-tech">JavaMailSender &middot; SMTP</span>
            </div>
            <div class="node-card external-card">
              <span class="n-icon">&#x1F4CA;</span>
              <span class="n-type" style="font-size:8px;">External Format</span>
              <span class="n-name" style="font-size:12px;">Excel / CSV</span>
              <span class="n-desc" style="font-size:10px;">Warehouse blueprint and goods list imports</span>
              <span class="n-tech">Apache POI &middot; OpenCSV</span>
            </div>
          </div>
        </div>

      </div>
    </div>
  </div>

  <!-- LEGEND -->
  <div class="legend">
    <div class="legend-item"><div class="legend-box" style="background:var(--system-bg); border-color:var(--system-border);"></div> Microservice (Spring Boot)</div>
    <div class="legend-item"><div class="legend-box" style="background:var(--db-bg); border-color:var(--db-border);"></div> Database (per service)</div>
    <div class="legend-item"><div class="legend-box" style="background:var(--container-bg); border-color:var(--container-border);"></div> Spring Cloud Infra / Cache</div>
    <div class="legend-item"><div class="legend-box" style="background:var(--kafka-bg); border-color:var(--kafka-border);"></div> Message Broker</div>
    <div class="legend-item"><div class="legend-box" style="background:var(--external-bg); border-color:var(--external-border);"></div> External System</div>
  </div>

  <!-- CONTAINER RELATIONSHIPS -->
  <div class="section" style="margin-top:32px;">
    <div class="section-title">Container Relationships</div>
    <div style="background:var(--white); border:1px solid var(--border); border-radius:12px; overflow:hidden;">
      <table class="rel-table">
        <thead>
          <tr><th>From</th><th style="text-align:center;">&rarr;</th><th>To</th><th>Description</th><th>Protocol</th></tr>
        </thead>
        <tbody>
          <tr><td class="from">Users (all roles)</td><td class="arrow">&rarr;</td><td class="to">API Gateway</td><td class="desc">All API calls enter through the gateway, which routes to appropriate microservice</td><td class="tech">REST / HTTPS / JSON</td></tr>
          <tr><td class="from">API Gateway</td><td class="arrow">&rarr;</td><td class="to">Eureka Server</td><td class="desc">Discovers service instances by name for request routing</td><td class="tech">Eureka Client</td></tr>
          <tr><td class="from">All Microservices</td><td class="arrow">&rarr;</td><td class="to">Eureka Server</td><td class="desc">Register on startup, send heartbeats, deregister on shutdown</td><td class="tech">Eureka Client</td></tr>
          <tr><td class="from">All Microservices</td><td class="arrow">&rarr;</td><td class="to">Config Server</td><td class="desc">Fetch centralized configuration on startup (DB URLs, Kafka config, feature flags)</td><td class="tech">Spring Cloud Config Client</td></tr>
          <tr><td class="from">All Microservices</td><td class="arrow">&rarr;</td><td class="to">Zipkin</td><td class="desc">Report trace spans automatically via Micrometer Tracing (auto-configured)</td><td class="tech">Micrometer Tracing / Brave</td></tr>
          <tr><td class="from">API Gateway</td><td class="arrow">&rarr;</td><td class="to">All Microservices</td><td class="desc">Routes domain-specific requests to the owning service; validates JWT</td><td class="tech">REST / HTTP</td></tr>
          <tr><td class="from">Each Microservice</td><td class="arrow">&rarr;</td><td class="to">Own PostgreSQL DB</td><td class="desc">Reads/writes business data + outbox_events table in the same transaction</td><td class="tech">JDBC / Spring Data JPA</td></tr>
          <tr><td class="from">Debezium (per service)</td><td class="arrow">&rarr;</td><td class="to">Kafka</td><td class="desc">Watches outbox_events table via CDC (Change Data Capture) and publishes pending events to Kafka topics</td><td class="tech">Debezium PostgreSQL Connector</td></tr>
          <tr><td class="from">Booking Service</td><td class="arrow">&rarr;</td><td class="to">Warehouse Service</td><td class="desc">Checks room/zone availability and pricing (via OpenFeign + Resilience4j circuit breaker)</td><td class="tech">OpenFeign / HTTP</td></tr>
          <tr><td class="from">Booking Service</td><td class="arrow">&rarr;</td><td class="to">Redis</td><td class="desc">Sets and checks room availability locks during booking creation to prevent double-booking</td><td class="tech">Spring Data Redis / Lettuce</td></tr>
          <tr><td class="from">Goods Service</td><td class="arrow">&rarr;</td><td class="to">Booking Service</td><td class="desc">Verifies booking is active before allowing goods upload (via OpenFeign + Resilience4j)</td><td class="tech">OpenFeign / HTTP</td></tr>
          <tr><td class="from">Delivery Service</td><td class="arrow">&rarr;</td><td class="to">Goods Service</td><td class="desc">Checks goods availability for picking (via OpenFeign + Resilience4j)</td><td class="tech">OpenFeign / HTTP</td></tr>
          <tr><td class="from">Kafka</td><td class="arrow">&rarr;</td><td class="to">Platform Service</td><td class="desc">Consumes all events (idempotent); sends emails, persists notifications, writes audit logs</td><td class="tech">Spring Kafka Consumer + DLT</td></tr>
          <tr><td class="from">Kafka</td><td class="arrow">&rarr;</td><td class="to">Billing Service</td><td class="desc">Consumes booking.confirmed (idempotent) to generate invoices</td><td class="tech">Spring Kafka Consumer + DLT</td></tr>
          <tr><td class="from">Kafka</td><td class="arrow">&rarr;</td><td class="to">Booking Service</td><td class="desc">Consumes payment.success (idempotent) to activate booking</td><td class="tech">Spring Kafka Consumer + DLT</td></tr>
          <tr><td class="from">Kafka</td><td class="arrow">&rarr;</td><td class="to">Warehouse Service</td><td class="desc">Consumes booking.cancelled, booking.expired (idempotent) to release rooms</td><td class="tech">Spring Kafka Consumer + DLT</td></tr>
          <tr><td class="from">Billing Service</td><td class="arrow">&rarr;</td><td class="to">Stripe</td><td class="desc">Creates Stripe Checkout sessions for invoice payments</td><td class="tech">Stripe Java SDK / HTTPS</td></tr>
          <tr><td class="from">Stripe</td><td class="arrow">&rarr;</td><td class="to">Billing Service</td><td class="desc">Fires webhook events for payment success or failure</td><td class="tech">HTTPS Webhook / JSON</td></tr>
          <tr><td class="from">Platform Service</td><td class="arrow">&rarr;</td><td class="to">SMTP / SendGrid</td><td class="desc">Sends transactional emails when Kafka events are consumed</td><td class="tech">JavaMailSender / SMTP</td></tr>
        </tbody>
      </table>
    </div>
  </div>

</div>

<!-- =========================================== LEVEL 3 =========================================== -->
<div class="page" id="l3">

  <div class="page-header">
    <div class="level-badge">LEVEL 3</div>
    <div class="page-header-text">
      <h2>Component Diagram</h2>
      <p>Zooms inside each <strong>microservice</strong> to show its internal components. Each service is a Spring Boot application with its own controllers, services, repositories, and entities. Services communicate through REST/HTTP for synchronous queries and Kafka events for async notifications. No service directly accesses another service's database.</p>
    </div>
  </div>

  <div class="info-grid">
    <div class="info-box">
      <h4>MICROSERVICE RULES</h4>
      <p>1. Each service owns its own database — no shared DB access. 2. Synchronous cross-service calls use REST/HTTP via OpenFeign with Resilience4j circuit breakers. 3. Async events go through the Transactional Outbox pattern (write to outbox table &rarr; Debezium CDC &rarr; Kafka). All consumers are idempotent with Dead Letter Topics. 4. JWT validation at API Gateway, propagated via Feign interceptors for service-to-service calls.</p>
    </div>
    <div class="info-box">
      <h4>WHY THIS STRUCTURE</h4>
      <p>Each microservice is independently deployable, scalable, and maintainable. Teams can work on separate services without stepping on each other. Database-per-service ensures strong data ownership and bounded contexts.</p>
    </div>
  </div>

  <!-- COMPONENT GRID -->
  <div class="section">
    <div class="section-title">MS1 — Identity Service (Auth + User + Security)</div>
    <div class="component-grid" style="grid-template-columns: repeat(3, 1fr);">

      <div class="component-item">
        <span class="ci-icon">&#x1F510;</span>
        <span class="ci-type">Component</span>
        <span class="ci-name">Auth Controller</span>
        <span class="ci-desc">User registration (owner, customer), login, JWT token generation and refresh, password reset flow.</span>
        <span class="ci-endpoints">POST /auth/register/owner<br>POST /auth/register/customer<br>POST /auth/login<br>POST /auth/refresh-token<br>POST /auth/forgot-password</span>
        <span class="ci-tech">Spring Security &middot; JWT &middot; BCrypt</span>
      </div>

      <div class="component-item">
        <span class="ci-icon">&#x1F465;</span>
        <span class="ci-type">Component</span>
        <span class="ci-name">User Controller</span>
        <span class="ci-desc">User profile management, Super Admin approval/rejection of warehouse owners, staff and delivery agent account creation by warehouse owners.</span>
        <span class="ci-endpoints">GET /users/me<br>PATCH /users/me<br>GET /admin/owners<br>PATCH /admin/owners/{id}/approve<br>POST /owner/staff<br>POST /owner/delivery-agents</span>
        <span class="ci-tech">Spring Data JPA &middot; Kafka Producer</span>
      </div>

      <div class="component-item" style="background:#f0f9ff; border-color:#0369a1;">
        <span class="ci-icon">&#x1F6E1;&#xFE0F;</span>
        <span class="ci-type" style="color:#0369a1;">Component</span>
        <span class="ci-name" style="color:#0369a1;">Security Filter</span>
        <span class="ci-desc">JWT generation, validation, and role extraction. Provides a shared JWT library that the API Gateway uses for token validation on every request.</span>
        <span class="ci-endpoints">Used by API Gateway for<br>token validation on all requests</span>
        <span class="ci-tech" style="background:white;">Spring Security &middot; JWT</span>
      </div>

    </div>
    <div class="explanation" style="margin-top:16px;">
      <strong>Database:</strong> identity_db &mdash; Owns: users, warehouse_owner_profiles, customer_profiles, staff_profiles, delivery_agent_profiles<br>
      <strong>Publishes:</strong> owner.approved, owner.rejected &mdash; <strong>Consumes:</strong> none
    </div>
  </div>

  <div class="section">
    <div class="section-title">MS2 — Warehouse Service (Warehouse + Zone + Room + Categories)</div>
    <div class="component-grid" style="grid-template-columns: repeat(3, 1fr);">

      <div class="component-item">
        <span class="ci-icon">&#x1F3ED;</span>
        <span class="ci-type">Component</span>
        <span class="ci-name">Warehouse Controller</span>
        <span class="ci-desc">Warehouse CRUD, image uploads, dynamic Excel template generation for warehouse blueprints, Excel import parsing and validation, publish/unpublish lifecycle.</span>
        <span class="ci-endpoints">POST /owner/warehouses<br>GET /warehouses (public)<br>GET /owner/warehouses/{id}/import/template<br>POST /owner/warehouses/{id}/import<br>PATCH /owner/warehouses/{id}/publish</span>
        <span class="ci-tech">Apache POI &middot; Spring Data JPA</span>
      </div>

      <div class="component-item">
        <span class="ci-icon">&#x1F5C2;&#xFE0F;</span>
        <span class="ci-type">Component</span>
        <span class="ci-name">Zone &amp; Room Controller</span>
        <span class="ci-desc">Zone and room management within warehouses. Zone availability date ranges. Room pricing per m&sup2; (daily/weekly/monthly). Availability checks exposed to Booking Service via REST.</span>
        <span class="ci-endpoints">POST /owner/warehouses/{id}/zones<br>POST /owner/zones/{id}/availabilities<br>POST /owner/zones/{id}/rooms<br>GET /warehouses/{id}/zones (public)<br>PATCH /owner/rooms/{id}/status</span>
        <span class="ci-tech">Spring Data JPA</span>
      </div>

      <div class="component-item">
        <span class="ci-icon">&#x1F3F7;&#xFE0F;</span>
        <span class="ci-type">Component</span>
        <span class="ci-name">Category Controller</span>
        <span class="ci-desc">Standalone category management. Categories are linked to zones and rooms via junction tables (zone_categories, room_categories).</span>
        <span class="ci-endpoints">POST /categories<br>GET /categories<br>POST /zones/{id}/categories<br>POST /rooms/{id}/categories</span>
        <span class="ci-tech">Spring Data JPA</span>
      </div>

    </div>
    <div class="explanation" style="margin-top:16px;">
      <strong>Database:</strong> warehouse_db &mdash; Owns: warehouses, warehouse_images, warehouse_excel_imports, categories, zones, zone_categories, zone_availabilities, rooms, room_categories<br>
      <strong>Publishes:</strong> none &mdash; <strong>Consumes:</strong> booking.cancelled (release room), booking.expired (release room)
    </div>
  </div>

  <div class="section">
    <div class="section-title">MS3 — Booking Service</div>
    <div class="component-grid" style="grid-template-columns: repeat(2, 1fr);">

      <div class="component-item">
        <span class="ci-icon">&#x1F4C5;</span>
        <span class="ci-type">Component</span>
        <span class="ci-name">Booking Controller</span>
        <span class="ci-desc">Booking request creation with availability check via Warehouse Service + Redis lock. Owner approval/rejection flow. Booking lifecycle management.</span>
        <span class="ci-endpoints">POST /customer/bookings<br>GET /customer/bookings<br>PATCH /owner/bookings/{id}/confirm<br>PATCH /owner/bookings/{id}/reject<br>PATCH /customer/bookings/{id}/cancel</span>
        <span class="ci-tech">Redis &middot; Kafka Producer &middot; Spring Data JPA</span>
      </div>

      <div class="component-item">
        <span class="ci-icon">&#x23F0;</span>
        <span class="ci-type">Component</span>
        <span class="ci-name">Booking Expiry Tracker</span>
        <span class="ci-desc">Tracks bookings nearing expiry. Responds to scheduler events from Platform Service to expire bookings and update statuses.</span>
        <span class="ci-endpoints">(Internal — event-driven)</span>
        <span class="ci-tech">Kafka Consumer &middot; Spring Data JPA</span>
      </div>

    </div>
    <div class="explanation" style="margin-top:16px;">
      <strong>Database:</strong> booking_db &mdash; Owns: bookings, booking_expiry_notifications<br>
      <strong>Calls:</strong> Warehouse Service (availability check) &mdash; <strong>Publishes:</strong> booking.confirmed, booking.cancelled &mdash; <strong>Consumes:</strong> payment.success (activate booking), booking.expiry.check (from scheduler)
    </div>
  </div>

  <div class="section">
    <div class="section-title">MS4 — Goods Service</div>
    <div class="component-grid" style="grid-template-columns: repeat(2, 1fr);">

      <div class="component-item">
        <span class="ci-icon">&#x1F4E6;</span>
        <span class="ci-type">Component</span>
        <span class="ci-name">Goods Import Controller</span>
        <span class="ci-desc">Dynamic goods Excel template generation, goods list upload and validation per booking, owner approval flow for imported goods.</span>
        <span class="ci-endpoints">GET /customer/bookings/{id}/goods/template<br>POST /customer/bookings/{id}/goods/import<br>PATCH /owner/goods/imports/{id}/approve<br>PATCH /owner/goods/imports/{id}/reject</span>
        <span class="ci-tech">Apache POI &middot; OpenCSV &middot; Kafka Producer</span>
      </div>

      <div class="component-item">
        <span class="ci-icon">&#x1F4CB;</span>
        <span class="ci-type">Component</span>
        <span class="ci-name">Goods Receipt Controller</span>
        <span class="ci-desc">Staff goods receipt confirmation with condition tracking (GOOD/DAMAGED/REJECTED) and discrepancy handling when received qty differs from expected.</span>
        <span class="ci-endpoints">POST /staff/goods/receipts<br>POST /staff/goods/receipts/{id}/items</span>
        <span class="ci-tech">Spring Data JPA &middot; Kafka Producer</span>
      </div>

    </div>
    <div class="explanation" style="margin-top:16px;">
      <strong>Database:</strong> goods_db &mdash; Owns: goods_excel_imports, goods_items, goods_receipts, goods_receipt_items<br>
      <strong>Calls:</strong> Booking Service (verify active booking) &mdash; <strong>Publishes:</strong> goods.import.pending, goods.approved, goods.rejected, goods.discrepancy &mdash; <strong>Consumes:</strong> none
    </div>
  </div>

  <div class="section">
    <div class="section-title">MS5 — Delivery Service</div>
    <div class="component-grid" style="grid-template-columns: repeat(2, 1fr);">

      <div class="component-item">
        <span class="ci-icon">&#x1F69A;</span>
        <span class="ci-type">Component</span>
        <span class="ci-name">Delivery Controller</span>
        <span class="ci-desc">Delivery request creation, staff picking flow, delivery agent notification and first-come-first-served claiming.</span>
        <span class="ci-endpoints">POST /customer/bookings/{id}/deliveries<br>PATCH /staff/deliveries/{id}/start-picking<br>POST /staff/deliveries/{id}/notify-agents<br>PATCH /agent/deliveries/{id}/claim</span>
        <span class="ci-tech">Kafka Producer &middot; Spring Data JPA</span>
      </div>

      <div class="component-item">
        <span class="ci-icon">&#x1F4CD;</span>
        <span class="ci-type">Component</span>
        <span class="ci-name">Shipment Controller</span>
        <span class="ci-desc">Shipment checkpoint state machine (PENDING &rarr; PICKED_UP &rarr; IN_TRANSIT &rarr; DELIVERED). Delivery agents update checkpoints with location and status.</span>
        <span class="ci-endpoints">POST /agent/shipments/{id}/checkpoints<br>GET /customer/shipments/{id}/track</span>
        <span class="ci-tech">Kafka Producer &middot; Spring Data JPA</span>
      </div>

    </div>
    <div class="explanation" style="margin-top:16px;">
      <strong>Database:</strong> delivery_db &mdash; Owns: delivery_requests, delivery_request_items, delivery_notifications, shipments, shipment_checkpoints<br>
      <strong>Calls:</strong> Goods Service (check item availability for picking), Booking Service (verify booking) &mdash; <strong>Publishes:</strong> delivery.ready, delivery.claimed, delivery.checkpoint &mdash; <strong>Consumes:</strong> none
    </div>
  </div>

  <div class="section">
    <div class="section-title">MS6 — Billing Service</div>
    <div class="component-grid" style="grid-template-columns: repeat(2, 1fr);">

      <div class="component-item">
        <span class="ci-icon">&#x1F4B3;</span>
        <span class="ci-type">Component</span>
        <span class="ci-name">Invoice Controller</span>
        <span class="ci-desc">Invoice generation (triggered by booking.confirmed event), Stripe Checkout session creation, credit note issuance by warehouse owner.</span>
        <span class="ci-endpoints">GET /customer/invoices<br>POST /customer/invoices/{id}/pay<br>GET /owner/invoices<br>POST /owner/invoices/{id}/credit-note</span>
        <span class="ci-tech">Stripe Java SDK &middot; Kafka Consumer/Producer</span>
      </div>

      <div class="component-item">
        <span class="ci-icon">&#x1F4B0;</span>
        <span class="ci-type">Component</span>
        <span class="ci-name">Payment Webhook Handler</span>
        <span class="ci-desc">Handles Stripe webhook callbacks for payment success and failure. Updates invoice status and publishes payment events.</span>
        <span class="ci-endpoints">POST /webhooks/stripe</span>
        <span class="ci-tech">Stripe Webhook &middot; Kafka Producer</span>
      </div>

    </div>
    <div class="explanation" style="margin-top:16px;">
      <strong>Database:</strong> billing_db &mdash; Owns: invoices, invoice_items, payments, credit_notes<br>
      <strong>Calls:</strong> Stripe (external) &mdash; <strong>Publishes:</strong> invoice.generated, payment.success, payment.failed &mdash; <strong>Consumes:</strong> booking.confirmed (generate invoice), invoice.overdue (from scheduler)
    </div>
  </div>

  <div class="section">
    <div class="section-title">MS7 — Platform Service (Notification + Audit + Scheduler)</div>
    <div class="component-grid" style="grid-template-columns: repeat(3, 1fr);">

      <div class="component-item">
        <span class="ci-icon">&#x1F514;</span>
        <span class="ci-type">Component</span>
        <span class="ci-name">Notification Handler</span>
        <span class="ci-desc">Kafka consumer for all system events. Persists in-app notifications to database. Sends transactional emails via JavaMailSender for every event type.</span>
        <span class="ci-endpoints">GET /notifications<br>PATCH /notifications/{id}/read<br>PATCH /notifications/read-all<br>GET /notifications/unread-count</span>
        <span class="ci-tech">Kafka Consumer &middot; JavaMailSender</span>
      </div>

      <div class="component-item" style="background:#f0fdf4; border-color:#15803d;">
        <span class="ci-icon">&#x1F4CB;</span>
        <span class="ci-type" style="color:#15803d;">Component</span>
        <span class="ci-name" style="color:#15803d;">Audit Logger</span>
        <span class="ci-desc">Kafka consumer that listens to all domain events and persists immutable audit log records with old and new values as JSONB.</span>
        <span class="ci-endpoints">(Internal &mdash; Kafka consumer only)</span>
        <span class="ci-tech" style="background:white;">Kafka Consumer &middot; JSONB</span>
      </div>

      <div class="component-item" style="background:var(--batch-bg); border-color:var(--batch-border);">
        <span class="ci-icon">&#x2699;&#xFE0F;</span>
        <span class="ci-type" style="color:var(--batch-text);">Component</span>
        <span class="ci-name" style="color:var(--batch-text);">Scheduler</span>
        <span class="ci-desc">Spring Batch jobs running on schedule. Booking expiry detection and overdue invoice marking. Fires Kafka events after processing.</span>
        <span class="ci-endpoints">Nightly: booking-expiry-job<br>Daily 8AM: overdue-invoice-job</span>
        <span class="ci-tech" style="background:white;">Spring Batch 6 &middot; Quartz</span>
      </div>

    </div>
    <div class="explanation" style="margin-top:16px;">
      <strong>Database:</strong> platform_db &mdash; Owns: notifications, audit_logs<br>
      <strong>Publishes:</strong> booking.expiry.soon, booking.expired, invoice.overdue &mdash; <strong>Consumes:</strong> ALL domain events (for notifications and audit logging)
    </div>
  </div>

  <!-- KAFKA EVENT MAP -->
  <div class="section">
    <div class="section-title">Kafka Event Map — How Services Communicate</div>
    <div class="explanation">
      Services never call each other for notifications. When something significant happens in one service, it publishes a Kafka event. Other services that care about that event consume it independently. This means services are fully decoupled — the Booking Service doesn't know or care that a Platform Service exists.
    </div>
    <div class="kafka-grid">
      <div class="kafka-event">
        <span class="ke-topic">booking.confirmed</span>
        <span class="ke-flow">Booking &rarr; Billing (generate invoice), Platform (notify customer + owner)</span>
      </div>
      <div class="kafka-event">
        <span class="ke-topic">booking.cancelled</span>
        <span class="ke-flow">Booking &rarr; Warehouse (release room), Platform (notify customer + owner)</span>
      </div>
      <div class="kafka-event">
        <span class="ke-topic">booking.expiry.soon</span>
        <span class="ke-flow">Platform (Scheduler) &rarr; Platform (email customer 7 days before expiry)</span>
      </div>
      <div class="kafka-event">
        <span class="ke-topic">booking.expired</span>
        <span class="ke-flow">Platform (Scheduler) &rarr; Warehouse (release room), Booking (update status), Platform (notify)</span>
      </div>
      <div class="kafka-event">
        <span class="ke-topic">goods.import.pending</span>
        <span class="ke-flow">Goods &rarr; Platform (notify owner to approve)</span>
      </div>
      <div class="kafka-event">
        <span class="ke-topic">goods.approved</span>
        <span class="ke-flow">Goods &rarr; Platform (email customer — bring goods within 24h)</span>
      </div>
      <div class="kafka-event">
        <span class="ke-topic">goods.rejected</span>
        <span class="ke-flow">Goods &rarr; Platform (email customer with rejection reason)</span>
      </div>
      <div class="kafka-event">
        <span class="ke-topic">goods.discrepancy</span>
        <span class="ke-flow">Goods &rarr; Platform (email customer about quantity mismatch)</span>
      </div>
      <div class="kafka-event">
        <span class="ke-topic">delivery.ready</span>
        <span class="ke-flow">Delivery &rarr; Platform (push to all available delivery agents)</span>
      </div>
      <div class="kafka-event">
        <span class="ke-topic">delivery.claimed</span>
        <span class="ke-flow">Delivery &rarr; Platform (email customer — delivery agent assigned)</span>
      </div>
      <div class="kafka-event">
        <span class="ke-topic">delivery.checkpoint</span>
        <span class="ke-flow">Delivery &rarr; Platform (email customer with checkpoint update)</span>
      </div>
      <div class="kafka-event">
        <span class="ke-topic">invoice.generated</span>
        <span class="ke-flow">Billing &rarr; Platform (email customer with invoice and payment link)</span>
      </div>
      <div class="kafka-event">
        <span class="ke-topic">payment.success</span>
        <span class="ke-flow">Billing &rarr; Booking (activate booking), Platform (email receipt)</span>
      </div>
      <div class="kafka-event">
        <span class="ke-topic">payment.failed</span>
        <span class="ke-flow">Billing &rarr; Platform (email customer with failure reason)</span>
      </div>
      <div class="kafka-event">
        <span class="ke-topic">invoice.overdue</span>
        <span class="ke-flow">Platform (Scheduler) &rarr; Billing (mark overdue), Platform (notify customer + owner)</span>
      </div>
      <div class="kafka-event">
        <span class="ke-topic">owner.approved</span>
        <span class="ke-flow">Identity &rarr; Platform (email owner — account approved, can start listing)</span>
      </div>
    </div>
  </div>

</div>

<!-- =========================================== LEVEL 4 =========================================== -->
<div class="page" id="l4">

  <div class="page-header">
    <div class="level-badge">LEVEL 4</div>
    <div class="page-header-text">
      <h2>Code — Entity Model</h2>
      <p>The most detailed level. Shows the key entities within each microservice's database with their fields and relationships. Each service has its own PostgreSQL database and owns its tables exclusively. This maps directly to the database schema and JPA entities.</p>
    </div>
  </div>

  <div class="info-grid">
    <div class="info-box">
      <h4>WHAT THIS LEVEL SHOWS</h4>
      <p>Key entities per service database with their primary fields. Every entity maps to a database table. Foreign keys (FK) show relationships within a service's database. Cross-service references use UUIDs without FK constraints (since they're in different databases).</p>
    </div>
    <div class="info-box">
      <h4>DESIGN DECISIONS</h4>
      <p>All PKs are UUID (not auto-increment) for security and distributed readiness. All enums stored as strings for readability. All timestamps use TIMESTAMPTZ for timezone safety. Soft-delete columns (deleted_at) are nullable. Database-per-service means no cross-database FK constraints.</p>
    </div>
  </div>

  <div class="section">
    <div class="section-title">Entity Model per Service Database</div>
    <div class="entity-modules">

      <!-- IDENTITY SERVICE -->
      <div class="entity-module">
        <div class="em-header" style="background:var(--person-bg); color:var(--person-text);">&#x1F510; Identity Service — identity_db</div>
        <div class="em-body">
          <div class="em-entity">
            <span class="em-entity-name" style="color:var(--person-text);">users</span>
            <div class="em-fields">
              <div class="em-field"><span class="em-field-name pk">id</span><span class="em-field-type">UUID PK</span></div>
              <div class="em-field"><span class="em-field-name">email</span><span class="em-field-type">VARCHAR UNIQUE</span></div>
              <div class="em-field"><span class="em-field-name">password</span><span class="em-field-type">VARCHAR</span></div>
              <div class="em-field"><span class="em-field-name">first_name, last_name</span><span class="em-field-type">VARCHAR</span></div>
              <div class="em-field"><span class="em-field-name">phone</span><span class="em-field-type">VARCHAR</span></div>
              <div class="em-field"><span class="em-field-name">role</span><span class="em-field-type">ENUM</span></div>
              <div class="em-field"><span class="em-field-name">status</span><span class="em-field-type">ENUM</span></div>
            </div>
          </div>
          <div class="em-entity">
            <span class="em-entity-name" style="color:var(--person-text);">warehouse_owner_profiles</span>
            <div class="em-fields">
              <div class="em-field"><span class="em-field-name pk">id</span><span class="em-field-type">UUID PK</span></div>
              <div class="em-field"><span class="em-field-name fk">user_id</span><span class="em-field-type">UUID FK &rarr; users</span></div>
              <div class="em-field"><span class="em-field-name">company_name</span><span class="em-field-type">VARCHAR</span></div>
              <div class="em-field"><span class="em-field-name">tax_id</span><span class="em-field-type">VARCHAR UNIQUE</span></div>
              <div class="em-field"><span class="em-field-name">address, city, country</span><span class="em-field-type">VARCHAR</span></div>
              <div class="em-field"><span class="em-field-name">approved_by</span><span class="em-field-type">UUID FK &rarr; users</span></div>
              <div class="em-field"><span class="em-field-name">approved_at</span><span class="em-field-type">TIMESTAMPTZ (nullable)</span></div>
              <div class="em-field"><span class="em-field-name">rejection_reason</span><span class="em-field-type">VARCHAR (nullable)</span></div>
              <div class="em-field"><span class="em-field-name">deleted_at</span><span class="em-field-type">TIMESTAMPTZ (nullable)</span></div>
            </div>
          </div>
          <div class="em-entity">
            <span class="em-entity-name" style="color:var(--person-text);">customer_profiles</span>
            <div class="em-fields">
              <div class="em-field"><span class="em-field-name fk">user_id</span><span class="em-field-type">UUID FK &rarr; users</span></div>
              <div class="em-field"><span class="em-field-name">company_name</span><span class="em-field-type">VARCHAR</span></div>
              <div class="em-field"><span class="em-field-name">tax_id</span><span class="em-field-type">VARCHAR UNIQUE</span></div>
              <div class="em-field"><span class="em-field-name">contact_person_name</span><span class="em-field-type">VARCHAR</span></div>
            </div>
          </div>
          <div class="em-entity">
            <span class="em-entity-name" style="color:var(--person-text);">staff_profiles</span>
            <div class="em-fields">
              <div class="em-field"><span class="em-field-name fk">user_id</span><span class="em-field-type">UUID FK &rarr; users</span></div>
              <div class="em-field"><span class="em-field-name">warehouse_id</span><span class="em-field-type">UUID (cross-service ref)</span></div>
              <div class="em-field"><span class="em-field-name">position</span><span class="em-field-type">VARCHAR</span></div>
            </div>
          </div>
          <div class="em-entity">
            <span class="em-entity-name" style="color:var(--person-text);">delivery_agent_profiles</span>
            <div class="em-fields">
              <div class="em-field"><span class="em-field-name fk">user_id</span><span class="em-field-type">UUID FK &rarr; users</span></div>
              <div class="em-field"><span class="em-field-name">warehouse_id</span><span class="em-field-type">UUID (cross-service ref)</span></div>
              <div class="em-field"><span class="em-field-name">vehicle_info</span><span class="em-field-type">VARCHAR</span></div>
            </div>
          </div>
        </div>
      </div>

      <!-- WAREHOUSE SERVICE -->
      <div class="entity-module">
        <div class="em-header" style="background:var(--system-bg); color:var(--system-text);">&#x1F3ED; Warehouse Service — warehouse_db</div>
        <div class="em-body">
          <div class="em-entity">
            <span class="em-entity-name" style="color:var(--system-text);">warehouses</span>
            <div class="em-fields">
              <div class="em-field"><span class="em-field-name pk">id</span><span class="em-field-type">UUID PK</span></div>
              <div class="em-field"><span class="em-field-name">owner_id</span><span class="em-field-type">UUID (cross-service ref)</span></div>
              <div class="em-field"><span class="em-field-name">name</span><span class="em-field-type">VARCHAR</span></div>
              <div class="em-field"><span class="em-field-name">address, city, country</span><span class="em-field-type">VARCHAR</span></div>
              <div class="em-field"><span class="em-field-name">latitude, longitude</span><span class="em-field-type">DECIMAL</span></div>
              <div class="em-field"><span class="em-field-name">total_surface_area</span><span class="em-field-type">DECIMAL m&sup2;</span></div>
              <div class="em-field"><span class="em-field-name">status</span><span class="em-field-type">DRAFT/PUBLISHED/...</span></div>
            </div>
          </div>
          <div class="em-entity">
            <span class="em-entity-name" style="color:var(--system-text);">warehouse_images</span>
            <div class="em-fields">
              <div class="em-field"><span class="em-field-name fk">warehouse_id</span><span class="em-field-type">UUID FK</span></div>
              <div class="em-field"><span class="em-field-name">url</span><span class="em-field-type">VARCHAR</span></div>
              <div class="em-field"><span class="em-field-name">is_primary</span><span class="em-field-type">BOOLEAN (unique per WH)</span></div>
            </div>
          </div>
          <div class="em-entity">
            <span class="em-entity-name" style="color:var(--system-text);">warehouse_excel_imports</span>
            <div class="em-fields">
              <div class="em-field"><span class="em-field-name fk">warehouse_id</span><span class="em-field-type">UUID FK</span></div>
              <div class="em-field"><span class="em-field-name">file_name, status</span><span class="em-field-type">VARCHAR/ENUM</span></div>
              <div class="em-field"><span class="em-field-name">total/success/failed_rows</span><span class="em-field-type">INT</span></div>
            </div>
          </div>
          <div class="em-entity">
            <span class="em-entity-name" style="color:var(--system-text);">categories</span>
            <div class="em-fields">
              <div class="em-field"><span class="em-field-name pk">id</span><span class="em-field-type">UUID PK</span></div>
              <div class="em-field"><span class="em-field-name">name</span><span class="em-field-type">VARCHAR UNIQUE</span></div>
              <div class="em-field"><span class="em-field-name">description</span><span class="em-field-type">VARCHAR</span></div>
            </div>
          </div>
          <div class="em-entity">
            <span class="em-entity-name" style="color:var(--system-text);">zones</span>
            <div class="em-fields">
              <div class="em-field"><span class="em-field-name fk">warehouse_id</span><span class="em-field-type">UUID FK</span></div>
              <div class="em-field"><span class="em-field-name">name</span><span class="em-field-type">VARCHAR UNIQUE/WH</span></div>
              <div class="em-field"><span class="em-field-name">temperature_type</span><span class="em-field-type">AMBIENT/REFRIG/FROZEN</span></div>
              <div class="em-field"><span class="em-field-name">total_surface_area</span><span class="em-field-type">DECIMAL m&sup2;</span></div>
              <div class="em-field"><span class="em-field-name">status</span><span class="em-field-type">ACTIVE/MAINTENANCE/...</span></div>
            </div>
          </div>
          <div class="em-entity">
            <span class="em-entity-name" style="color:var(--system-text);">zone_categories, room_categories</span>
            <div class="em-fields">
              <div class="em-field"><span class="em-field-name fk">zone_id / room_id</span><span class="em-field-type">UUID FK</span></div>
              <div class="em-field"><span class="em-field-name fk">category_id</span><span class="em-field-type">UUID FK</span></div>
            </div>
          </div>
          <div class="em-entity">
            <span class="em-entity-name" style="color:var(--system-text);">zone_availabilities</span>
            <div class="em-fields">
              <div class="em-field"><span class="em-field-name fk">zone_id</span><span class="em-field-type">UUID FK</span></div>
              <div class="em-field"><span class="em-field-name">start_date, end_date</span><span class="em-field-type">DATE</span></div>
            </div>
          </div>
          <div class="em-entity">
            <span class="em-entity-name" style="color:var(--system-text);">rooms</span>
            <div class="em-fields">
              <div class="em-field"><span class="em-field-name fk">zone_id</span><span class="em-field-type">UUID FK</span></div>
              <div class="em-field"><span class="em-field-name">name</span><span class="em-field-type">VARCHAR UNIQUE/zone</span></div>
              <div class="em-field"><span class="em-field-name">total_surface_area</span><span class="em-field-type">DECIMAL m&sup2;</span></div>
              <div class="em-field"><span class="em-field-name">price_per_sqm_daily</span><span class="em-field-type">DECIMAL</span></div>
              <div class="em-field"><span class="em-field-name">price_per_sqm_weekly</span><span class="em-field-type">DECIMAL</span></div>
              <div class="em-field"><span class="em-field-name">price_per_sqm_monthly</span><span class="em-field-type">DECIMAL</span></div>
              <div class="em-field"><span class="em-field-name">status</span><span class="em-field-type">AVAILABLE/BOOKED/...</span></div>
              <div class="em-field"><span class="em-field-name">deleted_at</span><span class="em-field-type">TIMESTAMPTZ (nullable)</span></div>
            </div>
          </div>
        </div>
      </div>

      <!-- BOOKING SERVICE -->
      <div class="entity-module">
        <div class="em-header" style="background:#fef3e8; color:#c26a1a;">&#x1F4C5; Booking Service — booking_db</div>
        <div class="em-body">
          <div class="em-entity">
            <span class="em-entity-name" style="color:#c26a1a;">bookings</span>
            <div class="em-fields">
              <div class="em-field"><span class="em-field-name pk">id</span><span class="em-field-type">UUID PK</span></div>
              <div class="em-field"><span class="em-field-name">customer_id</span><span class="em-field-type">UUID (cross-service ref)</span></div>
              <div class="em-field"><span class="em-field-name">warehouse_id</span><span class="em-field-type">UUID (cross-service ref)</span></div>
              <div class="em-field"><span class="em-field-name">booking_type</span><span class="em-field-type">ROOM/ZONE/WAREHOUSE</span></div>
              <div class="em-field"><span class="em-field-name">room_id</span><span class="em-field-type">UUID (nullable)</span></div>
              <div class="em-field"><span class="em-field-name">zone_id</span><span class="em-field-type">UUID (nullable)</span></div>
              <div class="em-field"><span class="em-field-name">start_date, end_date</span><span class="em-field-type">DATE</span></div>
              <div class="em-field"><span class="em-field-name">surface_area</span><span class="em-field-type">DECIMAL m&sup2;</span></div>
              <div class="em-field"><span class="em-field-name">total_price</span><span class="em-field-type">DECIMAL</span></div>
              <div class="em-field"><span class="em-field-name">status</span><span class="em-field-type">PENDING/CONFIRMED/...</span></div>
              <div class="em-field"><span class="em-field-name">deleted_at</span><span class="em-field-type">TIMESTAMPTZ (nullable)</span></div>
            </div>
          </div>
          <div class="em-entity">
            <span class="em-entity-name" style="color:#c26a1a;">booking_expiry_notifications</span>
            <div class="em-fields">
              <div class="em-field"><span class="em-field-name fk">booking_id</span><span class="em-field-type">UUID FK UNIQUE</span></div>
              <div class="em-field"><span class="em-field-name">notified_at</span><span class="em-field-type">TIMESTAMPTZ</span></div>
              <div class="em-field"><span class="em-field-name">status</span><span class="em-field-type">SENT/ACKNOWLEDGED</span></div>
            </div>
          </div>
        </div>
      </div>

      <!-- GOODS SERVICE -->
      <div class="entity-module">
        <div class="em-header" style="background:#fef9e8; color:#8a7a1a;">&#x1F4E6; Goods Service — goods_db</div>
        <div class="em-body">
          <div class="em-entity">
            <span class="em-entity-name" style="color:#8a7a1a;">goods_excel_imports</span>
            <div class="em-fields">
              <div class="em-field"><span class="em-field-name pk">id</span><span class="em-field-type">UUID PK</span></div>
              <div class="em-field"><span class="em-field-name">booking_id</span><span class="em-field-type">UUID (cross-service ref)</span></div>
              <div class="em-field"><span class="em-field-name">customer_id</span><span class="em-field-type">UUID (cross-service ref)</span></div>
              <div class="em-field"><span class="em-field-name">file_name, status</span><span class="em-field-type">VARCHAR/ENUM</span></div>
              <div class="em-field"><span class="em-field-name">total/success/failed_rows</span><span class="em-field-type">INT</span></div>
              <div class="em-field"><span class="em-field-name">arrival_deadline</span><span class="em-field-type">TIMESTAMPTZ</span></div>
              <div class="em-field"><span class="em-field-name">approved_by, approved_at</span><span class="em-field-type">UUID/TIMESTAMPTZ</span></div>
            </div>
          </div>
          <div class="em-entity">
            <span class="em-entity-name" style="color:#8a7a1a;">goods_items</span>
            <div class="em-fields">
              <div class="em-field"><span class="em-field-name fk">goods_import_id</span><span class="em-field-type">UUID FK</span></div>
              <div class="em-field"><span class="em-field-name">name, sku, barcode</span><span class="em-field-type">VARCHAR</span></div>
              <div class="em-field"><span class="em-field-name">quantity</span><span class="em-field-type">DECIMAL</span></div>
              <div class="em-field"><span class="em-field-name">status</span><span class="em-field-type">PENDING/IN_WAREHOUSE/...</span></div>
              <div class="em-field"><span class="em-field-name">deleted_at</span><span class="em-field-type">TIMESTAMPTZ (nullable)</span></div>
            </div>
          </div>
          <div class="em-entity">
            <span class="em-entity-name" style="color:#8a7a1a;">goods_receipts</span>
            <div class="em-fields">
              <div class="em-field"><span class="em-field-name">booking_id</span><span class="em-field-type">UUID (cross-service ref)</span></div>
              <div class="em-field"><span class="em-field-name">received_by</span><span class="em-field-type">UUID (cross-service ref)</span></div>
              <div class="em-field"><span class="em-field-name">inbound_carrier</span><span class="em-field-type">VARCHAR</span></div>
            </div>
          </div>
          <div class="em-entity">
            <span class="em-entity-name" style="color:#8a7a1a;">goods_receipt_items</span>
            <div class="em-fields">
              <div class="em-field"><span class="em-field-name fk">goods_receipt_id</span><span class="em-field-type">UUID FK</span></div>
              <div class="em-field"><span class="em-field-name fk">goods_item_id</span><span class="em-field-type">UUID FK</span></div>
              <div class="em-field"><span class="em-field-name">expected_qty, received_qty</span><span class="em-field-type">DECIMAL</span></div>
              <div class="em-field"><span class="em-field-name">condition</span><span class="em-field-type">GOOD/DAMAGED/REJECTED</span></div>
            </div>
          </div>
        </div>
      </div>

      <!-- DELIVERY SERVICE -->
      <div class="entity-module">
        <div class="em-header" style="background:var(--component-bg); color:var(--component-text);">&#x1F69A; Delivery Service — delivery_db</div>
        <div class="em-body">
          <div class="em-entity">
            <span class="em-entity-name" style="color:var(--component-text);">delivery_requests</span>
            <div class="em-fields">
              <div class="em-field"><span class="em-field-name pk">id</span><span class="em-field-type">UUID PK</span></div>
              <div class="em-field"><span class="em-field-name">booking_id</span><span class="em-field-type">UUID (cross-service ref)</span></div>
              <div class="em-field"><span class="em-field-name">customer_id</span><span class="em-field-type">UUID (cross-service ref)</span></div>
              <div class="em-field"><span class="em-field-name">destination_address</span><span class="em-field-type">VARCHAR</span></div>
              <div class="em-field"><span class="em-field-name">requested_date</span><span class="em-field-type">DATE</span></div>
              <div class="em-field"><span class="em-field-name">status</span><span class="em-field-type">PENDING/CONFIRMED/...</span></div>
            </div>
          </div>
          <div class="em-entity">
            <span class="em-entity-name" style="color:var(--component-text);">delivery_request_items</span>
            <div class="em-fields">
              <div class="em-field"><span class="em-field-name fk">delivery_request_id</span><span class="em-field-type">UUID FK</span></div>
              <div class="em-field"><span class="em-field-name">goods_item_id</span><span class="em-field-type">UUID (cross-service ref)</span></div>
              <div class="em-field"><span class="em-field-name">requested_qty, picked_qty</span><span class="em-field-type">DECIMAL</span></div>
              <div class="em-field"><span class="em-field-name">picked_by, picked_at</span><span class="em-field-type">UUID/TIMESTAMPTZ</span></div>
            </div>
          </div>
          <div class="em-entity">
            <span class="em-entity-name" style="color:var(--component-text);">delivery_notifications</span>
            <div class="em-fields">
              <div class="em-field"><span class="em-field-name fk">delivery_request_id</span><span class="em-field-type">UUID FK</span></div>
              <div class="em-field"><span class="em-field-name">status</span><span class="em-field-type">OPEN/CLAIMED/EXPIRED</span></div>
              <div class="em-field"><span class="em-field-name">expires_at</span><span class="em-field-type">TIMESTAMPTZ</span></div>
            </div>
          </div>
          <div class="em-entity">
            <span class="em-entity-name" style="color:var(--component-text);">shipments</span>
            <div class="em-fields">
              <div class="em-field"><span class="em-field-name fk">delivery_request_id</span><span class="em-field-type">UUID FK</span></div>
              <div class="em-field"><span class="em-field-name">claimed_by</span><span class="em-field-type">UUID (cross-service ref)</span></div>
              <div class="em-field"><span class="em-field-name">tracking_number</span><span class="em-field-type">VARCHAR UNIQUE</span></div>
              <div class="em-field"><span class="em-field-name">estimated_delivery_date</span><span class="em-field-type">DATE</span></div>
              <div class="em-field"><span class="em-field-name">actual_delivery_date</span><span class="em-field-type">DATE (nullable)</span></div>
              <div class="em-field"><span class="em-field-name">status</span><span class="em-field-type">PENDING/PICKED_UP/...</span></div>
            </div>
          </div>
          <div class="em-entity">
            <span class="em-entity-name" style="color:var(--component-text);">shipment_checkpoints</span>
            <div class="em-fields">
              <div class="em-field"><span class="em-field-name fk">shipment_id</span><span class="em-field-type">UUID FK</span></div>
              <div class="em-field"><span class="em-field-name">status</span><span class="em-field-type">PENDING/PICKED_UP/...</span></div>
              <div class="em-field"><span class="em-field-name">location, note</span><span class="em-field-type">VARCHAR/TEXT</span></div>
              <div class="em-field"><span class="em-field-name">recorded_at</span><span class="em-field-type">TIMESTAMPTZ</span></div>
            </div>
          </div>
        </div>
      </div>

      <!-- BILLING SERVICE -->
      <div class="entity-module">
        <div class="em-header" style="background:var(--system-bg); color:var(--system-text);">&#x1F4B3; Billing Service — billing_db</div>
        <div class="em-body">
          <div class="em-entity">
            <span class="em-entity-name" style="color:var(--system-text);">invoices</span>
            <div class="em-fields">
              <div class="em-field"><span class="em-field-name pk">id</span><span class="em-field-type">UUID PK</span></div>
              <div class="em-field"><span class="em-field-name">customer_id</span><span class="em-field-type">UUID (cross-service ref)</span></div>
              <div class="em-field"><span class="em-field-name">warehouse_id</span><span class="em-field-type">UUID (cross-service ref)</span></div>
              <div class="em-field"><span class="em-field-name">booking_id</span><span class="em-field-type">UUID (nullable)</span></div>
              <div class="em-field"><span class="em-field-name">delivery_request_id</span><span class="em-field-type">UUID (nullable)</span></div>
              <div class="em-field"><span class="em-field-name">invoice_type</span><span class="em-field-type">BOOKING/DELIVERY</span></div>
              <div class="em-field"><span class="em-field-name">amount, currency</span><span class="em-field-type">DECIMAL/VARCHAR</span></div>
              <div class="em-field"><span class="em-field-name">status</span><span class="em-field-type">DRAFT/SENT/PAID/...</span></div>
              <div class="em-field"><span class="em-field-name">due_date</span><span class="em-field-type">DATE</span></div>
            </div>
          </div>
          <div class="em-entity">
            <span class="em-entity-name" style="color:var(--system-text);">invoice_items</span>
            <div class="em-fields">
              <div class="em-field"><span class="em-field-name fk">invoice_id</span><span class="em-field-type">UUID FK</span></div>
              <div class="em-field"><span class="em-field-name">description</span><span class="em-field-type">VARCHAR</span></div>
              <div class="em-field"><span class="em-field-name">quantity, unit_price, total</span><span class="em-field-type">DECIMAL</span></div>
            </div>
          </div>
          <div class="em-entity">
            <span class="em-entity-name" style="color:var(--system-text);">payments</span>
            <div class="em-fields">
              <div class="em-field"><span class="em-field-name fk">invoice_id</span><span class="em-field-type">UUID FK</span></div>
              <div class="em-field"><span class="em-field-name">stripe_payment_id</span><span class="em-field-type">VARCHAR UNIQUE</span></div>
              <div class="em-field"><span class="em-field-name">stripe_receipt_url</span><span class="em-field-type">VARCHAR</span></div>
              <div class="em-field"><span class="em-field-name">amount, status</span><span class="em-field-type">DECIMAL/ENUM</span></div>
              <div class="em-field"><span class="em-field-name">failure_reason</span><span class="em-field-type">VARCHAR</span></div>
              <div class="em-field"><span class="em-field-name">paid_at</span><span class="em-field-type">TIMESTAMPTZ (nullable)</span></div>
            </div>
          </div>
          <div class="em-entity">
            <span class="em-entity-name" style="color:var(--system-text);">credit_notes</span>
            <div class="em-fields">
              <div class="em-field"><span class="em-field-name fk">invoice_id</span><span class="em-field-type">UUID FK</span></div>
              <div class="em-field"><span class="em-field-name">reason</span><span class="em-field-type">TEXT</span></div>
              <div class="em-field"><span class="em-field-name">amount</span><span class="em-field-type">DECIMAL</span></div>
            </div>
          </div>
        </div>
      </div>

      <!-- PLATFORM SERVICE -->
      <div class="entity-module">
        <div class="em-header" style="background:var(--db-bg); color:var(--db-text);">&#x1F514; Platform Service — platform_db</div>
        <div class="em-body">
          <div class="em-entity">
            <span class="em-entity-name" style="color:var(--db-text);">notifications</span>
            <div class="em-fields">
              <div class="em-field"><span class="em-field-name pk">id</span><span class="em-field-type">UUID PK</span></div>
              <div class="em-field"><span class="em-field-name">user_id</span><span class="em-field-type">UUID (cross-service ref)</span></div>
              <div class="em-field"><span class="em-field-name">type</span><span class="em-field-type">ENUM (15 types)</span></div>
              <div class="em-field"><span class="em-field-name">message</span><span class="em-field-type">TEXT</span></div>
              <div class="em-field"><span class="em-field-name">is_read</span><span class="em-field-type">BOOLEAN</span></div>
              <div class="em-field"><span class="em-field-name">read_at</span><span class="em-field-type">TIMESTAMPTZ (nullable)</span></div>
              <div class="em-field"><span class="em-field-name">link</span><span class="em-field-type">VARCHAR</span></div>
            </div>
          </div>
          <div class="em-entity">
            <span class="em-entity-name" style="color:var(--db-text);">audit_logs</span>
            <div class="em-fields">
              <div class="em-field"><span class="em-field-name pk">id</span><span class="em-field-type">UUID PK</span></div>
              <div class="em-field"><span class="em-field-name">performed_by</span><span class="em-field-type">UUID (no FK — immutable)</span></div>
              <div class="em-field"><span class="em-field-name">action</span><span class="em-field-type">VARCHAR</span></div>
              <div class="em-field"><span class="em-field-name">entity_type, entity_id</span><span class="em-field-type">VARCHAR/UUID</span></div>
              <div class="em-field"><span class="em-field-name">old_value</span><span class="em-field-type">JSONB (nullable)</span></div>
              <div class="em-field"><span class="em-field-name">new_value</span><span class="em-field-type">JSONB (nullable)</span></div>
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>

  <!-- LEGEND -->
  <div class="legend">
    <div class="legend-item"><span style="color:#f59e0b; font-family:var(--mono); font-weight:700; font-size:12px;">PK</span> Primary Key — UUID</div>
    <div class="legend-item"><span style="color:#3b82f6; font-family:var(--mono); font-weight:700; font-size:12px;">FK</span> Foreign Key — references table in same database</div>
    <div class="legend-item"><span style="font-family:var(--mono); font-size:11px;">cross-service ref</span> UUID reference to another service's data (no FK constraint)</div>
    <div class="legend-item"><span style="font-family:var(--mono); font-size:11px;">ENUM</span> Constrained set of string values stored as VARCHAR</div>
    <div class="legend-item"><span style="font-family:var(--mono); font-size:11px;">nullable</span> Only justified future-state fields (approved_at, paid_at, deleted_at etc.)</div>
  </div>

  <!-- TABLE COUNT SUMMARY -->
  <div class="section" style="margin-top:32px;">
    <div class="section-title">Table Summary per Service</div>
    <div style="background:var(--white); border:1px solid var(--border); border-radius:12px; overflow:hidden;">
      <table class="rel-table">
        <thead>
          <tr><th>Service</th><th>Database</th><th>Tables</th><th>Key Entities</th></tr>
        </thead>
        <tbody>
          <tr><td class="from">Identity Service</td><td class="tech">identity_db</td><td>5 + outbox</td><td class="desc">users, warehouse_owner_profiles, customer_profiles, staff_profiles, delivery_agent_profiles, outbox_events</td></tr>
          <tr><td class="from">Warehouse Service</td><td class="tech">warehouse_db</td><td>9 + outbox</td><td class="desc">warehouses, warehouse_images, warehouse_excel_imports, categories, zones, zone_categories, zone_availabilities, rooms, room_categories, outbox_events</td></tr>
          <tr><td class="from">Booking Service</td><td class="tech">booking_db</td><td>2 + outbox</td><td class="desc">bookings, booking_expiry_notifications, outbox_events</td></tr>
          <tr><td class="from">Goods Service</td><td class="tech">goods_db</td><td>4 + outbox</td><td class="desc">goods_excel_imports, goods_items, goods_receipts, goods_receipt_items, outbox_events</td></tr>
          <tr><td class="from">Delivery Service</td><td class="tech">delivery_db</td><td>5 + outbox</td><td class="desc">delivery_requests, delivery_request_items, delivery_notifications, shipments, shipment_checkpoints, outbox_events</td></tr>
          <tr><td class="from">Billing Service</td><td class="tech">billing_db</td><td>4 + outbox</td><td class="desc">invoices, invoice_items, payments, credit_notes, outbox_events</td></tr>
          <tr><td class="from">Platform Service</td><td class="tech">platform_db</td><td>2 + outbox</td><td class="desc">notifications, audit_logs, outbox_events</td></tr>
          <tr style="background:#f9fafb;"><td class="from" style="font-weight:800;">Total</td><td></td><td style="font-weight:800;">31 + 7 outbox = 38 tables</td><td class="desc" style="font-weight:600;">7 services &middot; 7 databases &middot; Transactional Outbox pattern &middot; Complete domain coverage</td></tr>
        </tbody>
      </table>
    </div>
  </div>

</div>

<script>
  function showPage(id, btn) {
    document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
    document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
    document.getElementById(id).classList.add('active');
    btn.classList.add('active');
    window.scrollTo(0, 0);
  }
</script>

</body>
</html>
